{{ header }}
<div id="product-category" class="container">
  <ul class="breadcrumb">
    {% for breadcrumb in breadcrumbs %}
    <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
    {% endfor %}
  </ul>
  {% if success %}
  <div class="alert alert-success alert-dismissible"><i class="fa fa-check-circle"></i> {{ success }}
    <button type="button" class="close" data-dismiss="alert">&times;</button>
  </div>
  {% endif %}
  <div class="row">{{ column_left }}
    {% if column_left and column_right %}
    {% set class = 'col-sm-6' %}
    {% elseif column_left or column_right %}
    {% set class = 'col-sm-9' %}
    {% else %}
    {% set class = 'col-sm-12' %}
    {% endif %}
    <div id="content" class="{{ class }}">{{ content_top }}
      <h2>
        {{ heading_title }}
        
            <span class="pull-right"><a href="{{ checkout }}" class="btn btn-primary">Nastavi na plaÄ‡anje</a></span>
      
      </h2>

      {% for Gift in giftCategories %}
      <h3>{{ Gift.spendMore != false ? Gift.NotSuitable : Gift.Suitable }}</h3>
      <div class="row" style="margin:0px -15px 50px -15px">
        {% for product in Gift.GiftProducts %}
        <div class="product-layout col-lg-3 col-md-3 col-sm-6 col-xs-12 {{ Gift.spendMore or product.product_id == giftAlreadyAdded.product_id ? 'faded' : '' }}">
          <div class="product-thumb transition">
            <div class="image"><a href="{{ product.href }}"><img src="{{ product.thumb }}" alt="{{ product.name }}" title="{{ product.name }}" class="img-responsive" /></a></div>
            <div class="caption">
              <h4><a href="{{ product.href }}">{{ product.name }}</a></h4>
          
              {% if product.rating %}
              <div class="rating">
                {% for i in 5 %}
                {% if product.rating < i %}
                <span class="fa fa-stack"><i class="fa fa-star-o fa-stack-2x"></i></span>
                {% else %}
                <span class="fa fa-stack"><i class="fa fa-star fa-stack-2x"></i><i class="fa fa-star-o fa-stack-2x"></i></span>
                {% endif %}
                {% endfor %}
              </div>
              {% endif %}
              {% if product.price %}
              <p class="price">
                {% if not product.special %}
                <strong><span style="text-decoration: line-through;">{{ product.price }}</span> {{ free_text }}</strong>
                {% else %}
                <strong><span style="text-decoration: line-through;">{{ product.special }}</span> {{ free_text }}</strong>
                {% endif %}
              </p>
              {% endif %}
            </div>
            <input type="hidden" name="productOptions" value="{{ product.productOptions }}">
            <div class="button-group">
              <button style="width:100%;" data-product-id="{{ product.product_id }}" type="button" {{ Gift.spendMore ? 'disabled' : '' }} class="gift_button btn btn-default"><i class="fa fa-shopping-cart"></i> <span class="hidden-xs hidden-sm hidden-md">{{ button_gift }}</span></button>
            </div>
          </div>
        </div>
      {% endfor %}
      </div>
      {% endfor %}

      {% if buttons %}
      <div class="buttons">
        <div class="pull-left"><a href="{{ cart }}" class="btn btn-default">{{ button_shopping }}</a></div>
        <div class="pull-right"><a href="{{ checkout }}" class="btn btn-primary">{{ button_checkout }}</a></div>
      </div>
      {% endif %}
      {{ content_bottom }}</div>
    {{ column_right }}</div>
</div>

<script type="text/javascript">

    function setGiftsToUnavailable(){
            $('.faded').each(function() {
                $(this).find('a').attr('href', 'javascript:void(0)')
                $(this).fadeTo(500,0.4);
                $(this).find('button').prop('disabled', true);
            });
    }

    $(document).ready(function() {
        $('.gift_button').click(function () {
            {% if giftAlreadyAdded %}
                var has_options = $(this).parent().parent().find('input[name="productOptions"]').val();
                if(has_options == '1') {
                     $.fancybox.open({
                        href : 'index.php?route={{ modulePath }}/getOptions&change=1&product_id=' + $(this).data('product-id'),
                            type : 'ajax',
                            padding : 50,
                            openEffect : 'elastic',
                            openSpeed  : 150,
                            fitToView   : true,
                     });
                } else {
                    $.ajax({
                        url: '{{ changeGiftLink }}',
                        type: 'post',
                        data: { product_id: $(this).data('product-id') },
                        success: function(json) {
                            location.reload();
                        },
                        error: function(xhr, ajaxOptions, thrownError) {
                            alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                        }
                    });
                }
             {% else %}
                var has_options = $(this).parent().parent().find('input[name="productOptions"]').val();
                if(has_options == '1') {
                    $.fancybox.open({
                    href : 'index.php?route={{ modulePath }}/getOptions&product_id=' + $(this).data('product-id'),
                        type : 'ajax',
                        padding : 50,
                        openEffect : 'elastic',
                        openSpeed  : 150,
                        fitToView   : true,
                    });
                } else {
                    cart.add($(this).data('product-id'));

                    $('.product-layout').addClass('faded');
                    setGiftsToUnavailable();

                     setTimeout(function(){
                      location.reload();
                    }, 1200);
                }
             {% endif %}
        });
        setGiftsToUnavailable();
    });
</script>


{{ footer }} 